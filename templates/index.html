<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Laptop Price Predictor</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <h1>Laptop Price Predictor</h1>
        <p class="subtitle">Enter laptop specifications to get an estimated price prediction</p>
      </div>
      
      <div class="form-body">
        <form id="specForm">
          <div class="section">
            <h2 class="section-title">Basic Information</h2>
            <div class="form-grid">
              <div class="form-group full-width">
                <label class="form-label" for="Company">Manufacturer</label>
                <select id="Company" class="form-select" required></select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="TypeName">Device Type</label>
                <select id="TypeName" class="form-select"></select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="OpSys">Operating System</label>
                <select id="OpSys" class="form-select"></select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="Weight">Weight (kg)</label>
                <input id="Weight" type="number" class="form-input" step="0.01" min="0.5" max="5" value="1.86" />
              </div>
            </div>
          </div>
          
          <div class="section">
            <h2 class="section-title">Display</h2>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label" for="Inches">Screen Size (inches)</label>
                <input id="Inches" type="number" class="form-input" step="0.1" min="7" max="20" value="15.6" />
              </div>
              
              <div class="form-group">
                <label class="form-label" for="ScreenResolution">Resolution</label>
                <input id="ScreenResolution" type="text" class="form-input" placeholder="1920x1080" value="1366x768" />
                <span class="input-hint">Format: WidthxHeight (e.g., 1920x1080)</span>
              </div>
              
              <div class="form-group">
                <label class="form-label">IPS Display</label>
                <div class="toggle-group">
                  <button type="button" class="toggle-btn active" data-field="is_ips" data-value="0">No</button>
                  <button type="button" class="toggle-btn" data-field="is_ips" data-value="1">Yes</button>
                </div>
              </div>
              
              <div class="form-group">
                <label class="form-label">Touchscreen</label>
                <div class="toggle-group">
                  <button type="button" class="toggle-btn active" data-field="is_touchscreen" data-value="0">No</button>
                  <button type="button" class="toggle-btn" data-field="is_touchscreen" data-value="1">Yes</button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="section">
            <h2 class="section-title">Performance</h2>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label" for="Cpu_name">Processor</label>
                <select id="Cpu_name" class="form-select"></select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="CPU_Speed_GHz">CPU Speed (GHz)</label>
                <select id="CPU_Speed_GHz" class="form-select"></select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="Ram">RAM (GB)</label>
                <select id="Ram" class="form-select"></select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="gpu_brand">Graphics Card</label>
                <select id="gpu_brand" class="form-select"></select>
              </div>
            </div>
          </div>
          
          <div class="section">
            <h2 class="section-title">Storage</h2>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label" for="SSD_GB">SSD Capacity (GB)</label>
                <select id="SSD_GB" class="form-select"></select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="HDD_GB">HDD Capacity (GB)</label>
                <select id="HDD_GB" class="form-select"></select>
              </div>
            </div>
          </div>
          
          <div class="button-group">
            <button type="submit" class="btn btn-primary" id="predictBtn">
              <span class="btn-text">Predict Price</span>
            </button>
            <button type="reset" class="btn btn-secondary">Reset Form</button>
          </div>
        </form>
        
        <div class="result-panel" id="resultPanel">
          <h3 class="result-title" id="resultTitle">Predicted Price</h3>
          <div class="price-label">Estimated Value</div>
          <div class="price-display" id="priceDisplay">$0</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const COMPANIES = ['HP','Dell','Lenovo','Asus','Microsoft','Toshiba','MSI','Google','Acer','Xiaomi','Apple','Mediacom','Samsung','Razer','Huawei','Chuwi','Vero','Fujitsu','LG'];
    const TYPENAMES = ['Notebook','2 in 1 Convertible','Gaming','Ultrabook','Workstation','Netbook'];
    const RAMS = [2,4,6,8,12,16,24,32,64];
    const OPS = ['other','windows','linux','mac'];
    const CPU_NAMES = ['Intel Core i3','Intel Core i5','Intel Core i7','amd','other intel'];
    const CPU_SPEED = [0.9,1.0,1.1,1.2,1.3,1.44,1.5,1.6,1.7,1.8,1.9,2.0,2.1,2.2,2.3,2.4,2.5,2.6,2.7,2.8,2.9,3.0,3.1,3.2,3.6];
    const SSDS = [0,8,16,32,64,128,180,240,256,512,768,1024];
    const HDDS = [0,32,128,500,1024,2048];
    const GPUS = ['Intel','Nvidia','AMD','ARM'];

    function fillSelect(id, arr, includeEmpty=true){
      const sel = document.getElementById(id);
      sel.innerHTML = '';
      if(includeEmpty){ 
        const opt = document.createElement('option'); 
        opt.value=''; 
        opt.innerText='Select an option'; 
        sel.appendChild(opt); 
      }
      arr.forEach(v=>{
        const o=document.createElement('option'); 
        o.value=v; 
        o.innerText=v; 
        sel.appendChild(o);
      });
    }

    fillSelect('Company', COMPANIES);
    fillSelect('TypeName', TYPENAMES);
    fillSelect('Ram', RAMS);
    fillSelect('OpSys', OPS);
    fillSelect('Cpu_name', CPU_NAMES);
    fillSelect('CPU_Speed_GHz', CPU_SPEED);
    fillSelect('SSD_GB', SSDS);
    fillSelect('HDD_GB', HDDS);
    fillSelect('gpu_brand', GPUS);

    // Set default values
    document.getElementById('Company').value = 'HP';
    document.getElementById('TypeName').value = 'Notebook';
    document.getElementById('Ram').value = 4;
    document.getElementById('OpSys').value = 'other';
    document.getElementById('Cpu_name').value = 'Intel Core i5';
    document.getElementById('CPU_Speed_GHz').value = 2.0;
    document.getElementById('SSD_GB').value = 0;
    document.getElementById('HDD_GB').value = 500;
    document.getElementById('gpu_brand').value = 'Intel';

    // Toggle button functionality
    const toggleValues = {is_ips: 0, is_touchscreen: 0};
    
    document.querySelectorAll('.toggle-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const field = btn.dataset.field;
        const value = parseInt(btn.dataset.value);
        const group = btn.parentElement;
        
        group.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        toggleValues[field] = value;
      });
    });

    // Form submission
    document.getElementById('specForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const resultPanel = document.getElementById('resultPanel');
      const priceDisplay = document.getElementById('priceDisplay');
      const resultTitle = document.getElementById('resultTitle');
      const predictBtn = document.getElementById('predictBtn');
      
      // Get resolution and calculate PPI
      const resolution = document.getElementById('ScreenResolution').value;
      const inches = parseFloat(document.getElementById('Inches').value);
      const [resX, resY] = resolution.split('x').map(v => parseInt(v));
      const ppi = resX && resY && inches ? Math.sqrt(resX**2 + resY**2) / inches : 0;
      
      // Build the data object matching your ML model format
      const formData = {
        Company: document.getElementById('Company').value,
        TypeName: document.getElementById('TypeName').value,
        Ram: parseInt(document.getElementById('Ram').value),
        OpSys: document.getElementById('OpSys').value,
        Weight: parseFloat(document.getElementById('Weight').value),
        ppi: ppi,
        is_ips: toggleValues.is_ips,
        is_touchscreen: toggleValues.is_touchscreen,
        Cpu_name: document.getElementById('Cpu_name').value,
        CPU_Speed_GHz: parseFloat(document.getElementById('CPU_Speed_GHz').value),
        SSD_GB: parseInt(document.getElementById('SSD_GB').value),
        HDD_GB: parseInt(document.getElementById('HDD_GB').value),
        gpu_brand: document.getElementById('gpu_brand').value
      };
      
      // Show loading state
      predictBtn.disabled = true;
      predictBtn.innerHTML = '<span class="spinner"></span><span class="btn-text">Predicting...</span>';
      resultPanel.classList.remove('show', 'error');
      
      try {
        // Send POST request to Flask backend
        const response = await fetch('/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });
        
        if (!response.ok) {
          throw new Error('Prediction request failed');
        }
        
        const result = await response.json();
        
        // Check if there's an error in the response
        if (result.error) {
          throw new Error(result.error);
        }
        
        // Display the predicted price
        const predictedPrice = result.price || result.prediction || result.laptop_price;
        priceDisplay.textContent = Number(predictedPrice).toLocaleString('en-US' , {
          style: 'currency',
          currency: 'INR',
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        })
        
        resultTitle.textContent = 'Predicted Price';
        resultPanel.classList.add('show');
        resultPanel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        
      } catch (error) {
        console.error('Prediction error:', error);
        resultPanel.classList.add('show', 'error');
        resultTitle.textContent = 'Prediction Error';
        priceDisplay.innerHTML = `<div class="error-message">${error.message || 'Unable to get price prediction. Please check your connection and try again.'}</div>`;
      } finally {
        predictBtn.disabled = false;
        predictBtn.innerHTML = '<span class="btn-text">Predict Price</span>';
      }
    });

    // Reset form
    document.getElementById('specForm').addEventListener('reset', () => {
      setTimeout(() => {
        toggleValues.is_ips = 0;
        toggleValues.is_touchscreen = 0;
        document.querySelectorAll('.toggle-btn').forEach(btn => {
          const field = btn.dataset.field;
          const value = parseInt(btn.dataset.value);
          if(value === toggleValues[field]) {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });
        
        // Hide result panel on reset
        document.getElementById('resultPanel').classList.remove('show', 'error');
      }, 0);
    });
  </script>
</body>
</html>